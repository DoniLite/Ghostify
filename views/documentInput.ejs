<%- include('components/rawHeader.ejs', {title: 'Ghostify | Poster-Documentparser', desc: 'Poster is a toolkit for articles redaction and document conversion'}) %>
<div class="p-6 bg-gray-950 w-screen h-screen flex flex-col gap-y-4 justify-center items-center">
  <h2 class="text-xl font-semibold text-white text-center">
    Uploader un Document
  </h2>

  <form id="uploadForm" method="post" action="/api/v1/poster/parser" class="space-y-4 max-w-3xl rounded-lg mb-4">
    <!-- Zone de dépôt de fichiers avec Drag-and-Drop -->
    <div
      id="dropArea"
      class="flex p-4 w-full text-center items-center justify-center h-40 border-2 border-dashed rounded-lg border-orange-500 bg-orange-200 text-orange-600 hover:bg-gray-100 transition-colors duration-300 cursor-pointer"
    >
      Glissez et déposez un fichier ou cliquez pour en sélectionner un
    </div>
    <input
      id="fileInput"
      type="file"
      name="file"
      class="hidden"
    />

    <!-- Informations sur le fichier sélectionné -->
    <div
      id="fileInfo"
      class="hidden p-3 bg-gray-100 rounded-lg text-gray-700 space-y-2"
    >
      <p><strong>Nom :</strong> <span id="fileName"></span></p>
      <p><strong>Taille :</strong> <span id="fileSize"></span> KB</p>
      <p><strong>Type :</strong> <span id="fileType"></span></p>
    </div>

    <!-- Bouton de soumission -->
    <button
      type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg focus:outline-none"
    >
      Uploader
    </button>
  </form>
</div>

<script nonce="<%= locals.cspNonce %>">
  const dropArea = document.getElementById('dropArea');
  const fileInput = document.getElementById('fileInput');

  // Activer l'effet de survol
  function handleDragOver(event) {
    event.preventDefault();
    dropArea.classList.add('bg-blue-50', 'border-blue-400');
    dropArea.classList.remove('bg-gray-50', 'border-dashed');
  }

  // Désactiver l'effet de survol
  function handleDragLeave(event) {
    event.preventDefault();
    dropArea.classList.remove('bg-blue-50', 'border-blue-400');
    dropArea.classList.add('bg-gray-50', 'border-dashed');
  }

  // Gestion du fichier déposé
  function handleDrop(event) {
    event.preventDefault();
    dropArea.classList.remove('bg-blue-50', 'border-blue-400');
    const file = event.dataTransfer.files[0];
    displayFileInfo(file);
  }

  // Gestion du changement de fichier (pour le clic)
  function handleFileChange(event) {
    const file = event.target.files[0];
    if (file) {
      displayFileInfo(file);
    }
  }

  // Afficher les informations du fichier
  function displayFileInfo(file) {
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = (
      file.size / 1024
    ).toFixed(2);
    document.getElementById('fileType').textContent = file.type;
    document.getElementById('fileInfo').classList.remove('hidden');
  }

  // Ouvrir le sélecteur de fichier au clic sur la zone de dépôt
  dropArea.addEventListener('click', () => fileInput.click());
  dropArea.addEventListener('dragover', handleDragOver);
  dropArea.addEventListener('dragleave', handleDragLeave);
  dropArea.addEventListener('drop', handleDrop);
  fileInput.addEventListener('change', handleFileChange);
</script>
<%- include('components/rawFooter.ejs') %>
